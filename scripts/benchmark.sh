#!/bin/bash
SCRIPT_DIR=$( cd -- "$( dirname -- "${BASH_SOURCE[0]}" )" &> /dev/null && pwd ) 
SCRIPT_DIR="$SCRIPT_DIR/.."

datasets_path="/data/datasets"

# Parse command line arguments
while [[ $# -gt 0 ]]; do
  case "$1" in
    -d | --datasets)
      datasets_path=$2
      shift
      shift
      ;;
    -h | --help)
      echo "Usage: $0 [options]"
      echo "Options:"
      echo "  -d, --datasets <path>  Path to the datasets directory"
      echo "  -h, --help             Display this help message"
      return 0 2>/dev/null
      exit 0
      ;;
    *)
    echo "Invalid argument: $1"
      return 1 2>/dev/null
      exit 1
      ;;
  esac
done

# check if the datasets path exists
if [ ! -d $datasets_path ]; then
  echo "Datasets path does not exist: $datasets_path"
  return 1 2>/dev/null
  exit 1
fi

benchs=("bfs" "sssp" "bc" "cc")
graphs=("hollywood-2009" "soc-orkut" "soc-LiveJournal1" "roadNet-CA" "kron_g500-logn21" "indochina-2004" "road_usa")

declare -A SOURCES=(
  ["roadNet-CA"]="63595 68803 69413 162712 179188 215065 223386 225072 231882 233610 242756 244290 254567 291628 294242 303814 313321 317816 337137 379809 380410 386440 393852 393959 402093 402284 415566 416848 417376 433166 444743 470812 476094 484444 499791 504001 523556 553050 590555 597491 605773 611383 618043 624275 626820 628684 638912 654072 658841 683233 758449 884611 983459 986251 993631 1003239 1008246 1038566 1051890 1058124 1061866 1062866 1066513 1067544 1090300 1125742 1169623 1171127 1172599 1208817 1211633 1221651 1271118 1293588 1299034 1305917 1312267 1312449 1313250 1319242 1323726 1325664 1342225 1438792 1683782 1686294 1705769 1718003 1725194 1726603 1730368 1736203 1823360 1844736 1848242 1852257 1871768 1872621 1877211 1964251"
  ["hollywood-2009"]="1564 11421 31922 38428 42013 55662 74822 85126 116695 121253 138998 177997 187746 204768 206548 214421 237123 242557 245058 247188 258499 292997 293302 320853 348618 362507 377096 383600 416376 431601 481642 486820 517242 522109 529642 531813 538805 573119 579840 581635 585371 591218 597646 602451 623076 636272 656377 677451 678986 682715 700710 703510 717474 722262 727281 739970 742458 743367 749536 752120 752302 755048 772429 807819 815770 816431 821484 824682 830459 841243 843969 854930 865517 870006 878792 884131 891239 892215 894811 904248 907457 909839 913231 919567 927132 930728 939300 945533 945720 955407 955764 988381 1002581 1009696 1010245 1011062 1011890 1028886 1033486 1035649"
  ["soc-orkut"]="2530 86966 96659 105537 111516 114017 146757 155403 168592 212213 217626 253758 268665 283564 284286 301658 302210 305642 320816 332954 367046 384547 401947 424845 440799 446604 487722 503498 530819 542627 545720 559366 561634 564706 608640 657473 659341 683026 689343 698989 709481 709846 719291 753129 801571 831205 831383 865782 884376 904330 913486 927662 942191 947226 950649 1828372 1828843 1854563 1867184 1934233 1941731 1944639 1954358 1998080 2102531 2107278 2135061 2159475 2169176 2184652 2219636 2222685 2232778 2252915 2300951 2308350 2311848 2317492 2317775 2356852 2374749 2420306 2478572 2489462 2612682 2616758 2629341 2635989 2643863 2647628 2679268 2688210 2690688 2743374 2817359 2851808 2866183 2873415 2879298 2964788"
  ["soc-LiveJournal1"]="100744 107249 149110 164687 189367 239583 295852 298228 324344 344173 369784 446875 462587 476377 571908 591051 605927 675303 741985 751713 840664 855402 938697 999509 1036338 1068926 1075573 1107036 1107803 1132227 1137774 1194208 1226545 1277048 1341257 1406455 1423503 1500210 1533026 1558456 1605141 1609207 1632526 1644931 1646589 1724277 1912513 1915198 2022835 2059506 2089241 2257619 2266461 2273417 2473871 2501889 2510392 2513291 2526040 2593191 2597137 2689584 2784733 2789509 2832789 2890200 2916781 2920738 2973456 3016294 3075395 3085523 3094146 3110994 3144141 3341945 3376816 3494912 3510288 3749922 3779727 3793642 3838973 3867591 3872779 3949387 4070894 415765 4203909 4214635 4289834 4433441 4459999 4489815 4536197 4575639 4621795 4688748 4690701 4826321"
  ["kron_g500-logn21"]="26780 27591 50175 81197 85486 203738 210380 218096 229725 237579 280800 286748 309612 387941 397646 403114 403988 461193 517401 547957 561284 561469 593082 596634 608753 624295 630814 637730 639491 654454 659169 663220 681531 687052 724281 731054 733759 756640 773360 780989 795539 798588 804234 818297 843326 846121 856781 906733 914465 927569 933629 963980 989381 998599 1049402 1053295 1082743 1083857 1088834 1118330 1119797 1135501 1154909 1239451 1377962 1390652 1419825 1435175 1450920 1471550 1488100 1535542 1535740 1535824 1536973 1577782 1600326 1626765 1627218 1637207 1659797 1685862 1690238 1705599 1752162 1763921 1827465 1845612 1882731 1884531 1924764 1950426 1952257 2027281 2027562 2031673 2043325 2053087 2060501 2062447"
  ["indochina-2004"]="56926 86450 148030 154316 155498 176597 182178 291167 328383 359632 369983 504618 579022 581598 587827 601202 604611 613033 615223 804644 821382 850944 987539 1062213 1074479 1090065 1135197 1139951 1140971 1249231 1254673 1302006 1385612 1436868 1437752 1509488 1540425 1610791 1637402 1642462 1644176 1663766 1684466 1686195 1703395 1739745 1740669 1751525 1756918 1763067 1776645 1782716 1815222 1833081 1955963 1980201 1992648 2014559 2075194 2091644 2266213 2278510 2408066 2422530 2446756 2455109 2489640 2489907 2497213 2498768 2512972 2515670 2518599 2518715 2519900 2528259 2528468 2562234 2590411 2599615 2640202 2708313 2734278 2862908 3056880 3064855 3083668 3098664 3187765 3362690 3442013 3444245 3671532 3706807 3882927 3884948 3898757 3984130 3989328 4003274 4041735 4048401 4048717 4058152 4067133 4075838 4075993 4090435 4095272 4103195 4181789 4209542 4275765 4294134 4403526 4423497 4428626 4434348 4473212 4493123 4603143 4609273 4697238 4703945 4737429 4765206 4770430 4883613 4972527 5037362 5062055 5141622 5156304 5270367 5275725 5280551 5284097 5296544 5318170 5362245 5492996 5520615 5531671 5556324 5590356 5593398 5603753 5728252 5733544 5755998 5845227 5848493 5856494 5883294 5904856 5911811 5922674 5947927 5953855 5963280 5972934 5983481 5988778 5998311 6027445 6038986 6041252 6046198 6050102 6136537 6164426 6166575 6208695 6216678 6374003 6388886 6415315 6418106 6422091 6438026 6465754 6512083 6547179 6558921 6626122 6634723 6959712 6978618 6979530 6999836 7034531 7034756 7057152 7078896 7112917 7116576 7132088 7168831 7175645 7196001"
  ["road_usa"]="8967677 16605384 12528723 20270859 23361023 21467029 5288336 19117321 22865827 22480768 8532047 14754673 23891199 10005200 6754597 11294990 21652475 2549965 18526190 2793349 17460282 13556790 10750282 9481662 5944393 21848821 3801764 13833730 23424954 9249255 14559248 149155 16170009 20267659 23635228 19611075 10004024 16420899 5891858 23352722 15123690 20774339 11594553 14038923 2656346 3939411 17207037 5442380 13263110 10606591 14046315 16704263 19531190 16499173 2755223 23295562 13915964 17422563 11736720 15461103 13769116 2679721 16261896 16586524 22964899 3985189 18925178 19489093 19744372 3971685 5814204 12707274 3337882 18753695 4945422 18974442 7396551 13560809 12571386 10582780 201180 12968630 7942598 4079573 5722650 7845337 8300062 1008324 15503806 5185110 14964572 7320340 4000067 15923591 544900 5181605 19238939 5590256 14686113 8423881"
)

function benchmark {
  bench=$1
  graph=$2
  graph_path=$datasets_path/$graph/$graph.bin

  sources=(${SOURCES[$graph]})

  mkdir -p $SCRIPT_DIR/logs/$bench

  echo Running $bench on $graph
  for source in "${sources[@]}"
  do
    echo -n '#'
    $SCRIPT_DIR/build/bin/$bench -b $graph_path -s $source >> $SCRIPT_DIR/logs/$bench/$graph.log 2>> $SCRIPT_DIR/logs/$bench/$graph.err
  done
  echo 
}

for bench in "${benchs[@]}"
do
  echo "Bench: $bench"
  for graph in "${graphs[@]}"
  do
    benchmark $bench $graph
  done
done
